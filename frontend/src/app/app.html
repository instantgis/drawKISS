<div class="flex flex-col gap-sm" style="padding: var(--space-xs); height: 100vh; height: 100dvh;">

  <header class="text-center">
    <h1 class="text-lg font-bold" style="margin: 0;">drawKISS</h1>
  </header>

  @if (error()) {
    <div class="card" style="border-color: var(--color-error); background: rgba(248, 113, 113, 0.1);">
      <p style="color: var(--color-error);">{{ error() }}</p>
    </div>
  }

  <div class="media-frame" style="flex: 1; min-height: 0;">
    @if (!cameraActive() && !processedImageUrl()) {
      <p class="text-muted">Camera preview will appear here</p>
    }
    <video #videoEl [class.hidden]="!cameraActive() || processedImageUrl()" autoplay playsinline muted></video>
    @if (processedImageUrl()) {
      <img [src]="processedImageUrl()" alt="Processed image" />
    }
  </div>
  <canvas #canvasEl class="hidden"></canvas>

  <div class="flex flex-center gap-md">
    @if (!cameraActive()) {
      <button class="btn btn-primary btn-lg" (click)="startCamera()">ðŸ“· Start Camera</button>
    } @else {
      <button class="btn btn-primary btn-icon" (click)="capture()" [disabled]="processing()">
        @if (processing()) {
          <span class="spinner"></span>
        } @else {
          ðŸ“¸
        }
      </button>
      <button class="btn btn-secondary" (click)="stopCamera()">Stop</button>
    }
    @if (processedImageUrl()) {
      <button class="btn btn-secondary" (click)="downloadImage()">ðŸ’¾ Save</button>
    }
  </div>

  <div class="card">
    <h2 class="text-lg font-bold mb-md">Processing Options</h2>
    
    <div class="flex flex-col gap-md">
      <div class="form-group">
        <label class="form-label">Mode</label>
        <select class="form-select" [value]="options().mode" (change)="updateOption('mode', $any($event.target).value)">
          <option value="posterize">Posterize</option>
          <option value="edges">Edges</option>
          <option value="both">Both</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Levels: {{ options().levels }}</label>
        <input type="range" class="form-range" min="2" max="8" [value]="options().levels" 
               (input)="updateOption('levels', +$any($event.target).value)" />
      </div>

      <div class="form-group">
        <label class="form-label">Blur Radius: {{ options().blur_radius }}</label>
        <input type="range" class="form-range" min="1" max="15" step="2" [value]="options().blur_radius" 
               (input)="updateOption('blur_radius', +$any($event.target).value)" />
      </div>

      @if (options().mode === 'edges' || options().mode === 'both') {
        <div class="form-group">
          <label class="form-label">Edge Threshold: {{ options().threshold }}</label>
          <input type="range" class="form-range" min="50" max="200" [value]="options().threshold" 
                 (input)="updateOption('threshold', +$any($event.target).value)" />
        </div>
      }

    </div>
  </div>

</div>

