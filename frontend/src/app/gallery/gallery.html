<div class="gallery-container">
  <header class="gallery-header">
    <h1>Gallery</h1>
    <a routerLink="/capture" class="btn btn-primary">+ New Photo</a>
  </header>

  <!-- Category filter -->
  @if (categories().length > 0) {
    <div class="category-bar">
      <button
        class="category-chip"
        [class.active]="selectedCategory() === null"
        (click)="selectCategory(null)">
        All
      </button>
      @for (cat of categories(); track cat.id) {
        <button
          class="category-chip"
          [class.active]="selectedCategory() === cat.id"
          (click)="selectCategory(cat.id)">
          {{ cat.name }}
        </button>
      }
    </div>
  }

  <!-- Loading state -->
  @if (isLoading()) {
    <div class="loading">Loading...</div>
  }

  <!-- Image grid -->
  @if (!isLoading()) {
    @if (filteredImages().length === 0) {
      <div class="empty-state">
        <p>No images yet</p>
        <p class="hint">Take a photo using New Photo</p>
      </div>
    } @else {
      <div class="image-grid">
        @for (image of filteredImages(); track image.id) {
          <div class="image-card">
            <button class="delete-btn" (click)="deleteImage($event, image)" title="Delete image">Ã—</button>
            @if (getProgressCount(image.id) > 0) {
              <button class="progress-badge" (click)="viewProgress($event, image.id)" title="View progress">
                ðŸ“¸ {{ getProgressCount(image.id) }}
              </button>
            }
            <img
              [src]="getThumbnailUrl(image)"
              [alt]="image.title || 'Untitled'"
              loading="lazy"
              (click)="openImage(image.id)"
            />
            <div class="image-info">
              <span class="image-title">{{ image.title || 'Untitled' }}</span>
              <span class="image-date">{{ formatDate(image.date_taken) }}</span>
            </div>
            <div class="image-actions">
              <button class="action-btn" (click)="addProgress($event, image.id)" title="Add progress photo">+ Progress</button>
              <button class="action-btn" (click)="openImage(image.id)" title="View on easel">Easel</button>
            </div>
          </div>
        }
      </div>

      @if (hasMore()) {
        <div class="load-more">
          <button class="btn btn-secondary" (click)="loadMore()" [disabled]="isLoadingMore()">
            {{ isLoadingMore() ? 'Loading...' : 'Load More' }}
          </button>
        </div>
      }
    }
  }
</div>
